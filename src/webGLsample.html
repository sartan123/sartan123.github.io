<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>WebGLプログラム</title>
    <script src="minMatrix.js"></script>
    <script src="main.js"></script>
    <script id="vs" type="x-shader/x-vertex">
        attribute vec3 position; // 頂点座標位置
        attribute vec3 normal; // 頂点法線
        attribute vec4 color; // 頂点色
        uniform mat4 mvpMatrix; // MVPマトリックス
        varying vec4 vColor;
        varying vec3 vNormal;
        void main(){
        vNormal = normal;
        vColor = color;
        gl_Position = mvpMatrix * vec4(position, 1.0);
        }
    </script>
    <script id="fs" type="x-shader/x-fragment">
        precision mediump float;
        uniform mat4 invMatrix; //  inverseマトリックス
        uniform vec3 lightDirection; // 平行光源の向き
        uniform vec3 eyePosition; // カメラの位置
        uniform vec3 centerPosition; // カメラの注視点
        uniform vec4 ambientColor;   // 環境光の色
        varying vec4 vColor;
        varying vec3 vNormal;
        void main(){
        // カメラの位置と注視点を用いて視線を算出
        vec3 eyeDirection = eyePosition - centerPosition;

        // 視線ベクトルを逆行列に変換
        vec3 invEye = normalize(invMatrix * vec4(eyeDirection, 1.0)).xyz;

        // ライトベクトルを逆行列に変換
        vec3 invLight = (invMatrix * vec4(lightDirection, 1.0)).xyz;

        // ハーフベクトルを算出
        vec3 halfVector = normalize(invLight + invEye);

        // 拡散光の強度を算出
        float diff = clamp(dot(normalize(invLight), vNormal), 0.1, 1.0);

        // 反射光の強度を算出
        float spec = pow(clamp(dot(halfVector, vNormal), 0.0, 1.0), 20.0);

        // 出力カラー
        vec3 dest = vColor.rgb * diff + spec + ambientColor.rgb;
        gl_FragColor = vec4(dest, vColor.a);
        }
    </script>
</head>
<body>
    <canvas id="canvas"></canvas>
</body>
</html>
